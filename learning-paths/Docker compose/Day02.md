
# Day 2: Defining Services, Networks, and Volumes

## Objective

- Learn how to define services, networks, and volumes in a `docker-compose.yml` file.
- Understand how containers communicate using networks.
- Use volumes for data persistence.

## Topics

### Defining Services in `docker-compose.yml`

Services represent the individual containers in your application. Each service is defined under the `services` section of the `docker-compose.yml` file. You can configure each service with specific options such as the image to use, ports to expose, environment variables, and dependencies.

Example:

```
version: '3.8'
services:
  web:
    image: nginx
    ports:
      - "8080:80"
```

### Networking in Docker Compose

Docker Compose automatically creates a default network for all services within a Compose file. Containers can communicate with each other using their service names as hostnames.

- **Custom Networks**: You can define custom networks to isolate services or enable communication between specific containers.

Example:

```
networks:
  app_network:
    driver: bridge
```

Assigning a service to a network:

```
services:
  web:
    image: nginx
    networks:
      - app_network
  db:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: example
    networks:
      - app_network

networks:
  app_network:
    driver: bridge
```

### Volumes for Data Persistence

Volumes allow you to persist data generated by containers so that it is not lost when the container stops or is removed.

- **Named Volumes**: Defined in the `volumes` section of the Compose file and shared across multiple services.

- **Bind Mounts**: Map directories on the host machine to directories in the container.

Example:

```
volumes:
  db_data:

services:
  db:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: example
    volumes:
      - db_data:/var/lib/mysql
```

---

## Activities

### Activity 1: Define Services in `docker-compose.yml`

1. Modify the `docker-compose.yml` file from Day 1 to include a database service (`db`) alongside the web server (`web`).
2. Ensure that both services are defined under the `services` section.

Example:

```
version: '3.8'
services:
  web:
    image: nginx
    ports:
      - "8080:80"
  db:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: example
```

### Activity 2: Create a Custom Network

1. Add a custom network named `app_network` to your Compose file.

2. Assign both the `web` and `db` services to this network.

Example:

```
version: '3.8'
services:
  web:
    image: nginx
    ports:
      - "8080:80"
    networks:
      - app_network
  db:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: example
    networks:
      - app_network

networks:
  app_network:
    driver: bridge
```

3. Verify that the containers can communicate using their service names (e.g., `ping db` from within the `web` container).

### Activity 3: Add a Named Volume for Data Persistence

1. Add a named volume called `db_data` to your Compose file.
2. Mount this volume to persist MySQL data in the database container.

Example:

```
version: '3.8'
services:
  web:
    image: nginx
    ports:
      - "8080:80"
    networks:
      - app_network
  db:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: example
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - app_network

volumes:
  db_data:

networks:
  app_network:
    driver: bridge
```

3. Verify that data persists even after stopping and restarting the containers with `docker-compose down` and `docker-compose up`.

---

## Additional References

For more detailed information on these topics, check out these resources:

- [Docker Compose Networking](https://docs.docker.com/compose/networking/)
- [Docker Volumes Documentation](https://docs.docker.com/storage/volumes/)
- [Compose File Reference](https://docs.docker.com/compose/compose-file/)
- [Docker Networking Overview](https://docs.docker.com/network/)
- [Persisting Data with Docker Volumes](https://docs.docker.com/storage/)
